# Rookie Contract Surplus Value (NBA) — Regression Residual Bar Chart

Instead of arguing “who’s the best rookie,” this project asks a more front-office question:

**Which teams are getting the most (or least) value per dollar from their rookies under the salary cap?**

We build a **regression-based value model** that learns what level of on-court production rookies *typically* deliver at a given **salary (rookie-scale contract)**, using **multi-season historical rookie data (adjusted for inflation)** and advanced box/impact-style metrics.  
For the current season, we compute each rookie’s **residual value**:

> **Residual Value = Actual Production − Expected Production (at that salary)**

- **Green bars** = *surplus value* (outperforming contract expectation)
- **Red bars** = *deficit value* (underperforming contract expectation)
- The **zero line** is the expectation for rookies at that price point.

This is an “efficiency under the cap” view: rookie deals can create huge value swings not because they’re perfect, but because **the cost is relatively fixed while the performance distribution is wide**.

---

## What you’ll get (final output)

A single shareable bar chart like:

- **Y-axis:** rookie names, teams
- **X-axis:** residual value (positive = surplus, negative = deficit)
- **Sorted:** highest surplus at top, biggest deficit at bottom
- **Colors:** green above 0, red below 0, vertical 0 line

Also exported:
- `outputs/current_rookies_residuals.csv`
- `outputs/model_report.md` (optional: fit quality, CV score, sanity checks)

---

## “Value Produced” (the target)

To keep this project fast and reproducible, we define a single **production target** from metrics available via the NBA stats ecosystem, e.g.:

### Default target (recommended for speed)
**`production = (PLAYER_IMPACT_ESTIMATE or PIE) * MINUTES`**

This gives:
- a *rate* proxy for impact
- scaled by *volume* (minutes played)

> You can swap the target later (e.g., use a different “impact” proxy, or add a second chart for another target).

---

## “Expected Value” model

We fit a regression model on historical rookies:

**`production ~ f(salary)`**

Where `f(·)` can be:
- **Spline / polynomial regression** (simple + interpretable)
- **Gradient boosting regressor** (more flexible, still quick)
- **Quantile regression** (optional: add “expected + uncertainty bands”)

Then compute **residuals** for the current season.

---

## Data sources (pragmatic + fast)

### Rookie stats & advanced metrics
Use `nba_api` (unofficial wrapper for stats.nba.com endpoints):
- player list + rookie seasons
- minutes, basic + advanced fields (TS%, USG%, PIE, etc.)

### Rookie salary
Fastest options (choose one):

**Option A (fastest): hardcode rookie-scale salary table by draft pick**
- Add a `data/rookie_scale_{season}.csv` (you can paste from a public table once)
- Map rookies → draft pick → year-1 salary  
- This is clean, reproducible, and avoids scraping.

**Option B: provide a CSV export**
- `data/current_rookie_salaries.csv` with columns: `player_name, salary, team`

**Option C (not recommended for speed): scrape a site**
- More brittle. Avoid unless you really want fully automated salary ingestion.

---

## Repo layout

```
NBA-Rookie-Contract-Regression-Value/
├── README.md
├── requirements.txt
├── main.py                    # Main CLI script to run analysis
├── data/
│   └── rookie_scale.csv       # Rookie salary scale by draft pick
├── outputs/                    # Generated by the script
│   ├── 2025-26_rookies_residuals.csv
│   ├── 2025-26_residual_bar_chart.png
│   ├── historical_data_2025-26.pkl  # Cached historical data
│   └── model.pkl
└── src/
    ├── config.py              # Configuration settings
    ├── fetch/
    │   ├── nba_stats.py       # Fetch NBA stats via API
    │   ├── rookies.py         # Identify rookies
    │   ├── draft.py           # Fetch draft data
    │   └── salaries.py        # Load salary data
    ├── features/
    │   └── build_dataset.py   # Build training/prediction datasets
    ├── model/
    │   ├── train.py           # Train regression model
    │   └── predict.py         # Calculate residuals
    └── viz/
        └── residual_chart.py  # Create bar chart visualization
```

---

## Quick Start

### 1. Install dependencies

```bash
pip install -r requirements.txt
```

### 2. Run the analysis

```bash
python main.py
```

The script will:
1. Check for cached historical data (or fetch from NBA API if not cached)
2. Train a regression model (salary → expected production)
3. Fetch current season (2025-26) rookie data
4. Calculate residual values (actual - expected production)
5. Generate visualization and export results

**Note:** Historical data is cached after first run. Subsequent runs are much faster since they load from cache instead of re-fetching from the API.

### 3. View outputs

- `outputs/2025-26_residual_bar_chart.png` - The main visualization
- `outputs/2025-26_rookies_residuals.csv` - Detailed data export
- `outputs/model.pkl` - Trained model (for reuse)
- `outputs/historical_data_2025-26.pkl` - Cached historical data (speeds up future runs)

---

## Configuration

Edit `src/config.py` to customize:
- Historical seasons for training
- Current season to analyze
- Minimum games played threshold
- Model type (gradient boosting, spline, etc.)
- Chart colors and size

### Clearing Cache

If you need to refresh historical data (e.g., mid-season updates):

```bash
rm outputs/historical_data_*.pkl
```

The next run will re-fetch from the NBA API and create a fresh cache.

